name: Create and publish a Docker image

on:
  push:
    branches:
      - main
      - dev
  workflow_dispatch:
  schedule:
    - cron: "0 0 * * *"

env:
  REGISTRY: ghcr.io
  REPO_NAME: ${{ github.repository }}

jobs:
  stage-1:
    strategy:
      matrix:
        image:
          - r-4-duckdb
          - r-minimal
          - rig-centos7
          - rig-rocky8
          - rig-ubuntu
          - rig-ubuntu-revdepcheck
          - rigraph-san
          - tofutf
    uses: cynkra/docker-images/.github/workflows/publish.yml@main
    with:
      image: ${{ matrix.image }}

  stage-2:
    needs: stage-1
    strategy:
      matrix:
        image:
          - RPostgres
          - dm
          - rig-ubuntu-dbi
          - rig-ubuntu-duckdb
          - rig-ubuntu-igraph
    uses: cynkra/docker-images/.github/workflows/publish.yml@main
    with:
      image: ${{ matrix.image }}
